<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Special+Elite&display=swap">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Black+Ops+One&display=swap">
    <title>Odd One Out</title>
    <link rel="icon" href="spy_icon_205840.ico" />
    <link rel="stylesheet" href="index.css">
  </head>
  <body>
    <!-- /////////////////////////////////////////////////////////////////////////////// -->
     <header>
      <h1 id= logo>Odd One Out</h1>
      <nav>
        <a href="index.html">Home</a>
        <a href="invitation.html">Sign In</a>
      </nav>
    </header>
    <!-- /////////////////////////////////////////////////////////////////////////////// -->
    <main class="smallPage">
        <table border="1" cellspacing="2" cellpadding="5" >
            <tr>
                <th>
                    Your Secret Word:
                </th>
                 <td id="secretWordDisplay">
                      <!-- Secret Word Generated Here -->
                    </td>
            </tr>
            </table>

            <div id="carousel">
              <!-- <div class="item">Other Player 1</div>
              <div class="item">Other Player 2</div>
              <div class="item">Other Player 3</div> -->
              <!-- DIV ELEMENTS INSERTED HERE -->
            </div>
      
            <form><button class="button" onclick="readTheVotes()" >Submit Vote</button></form>
    </main>
    <!-- /////////////////////////////////////////////////////////////////////////////// -->
    <footer>
      <span class="footer-info">Brixtin Walker</span>
      <span class="footer-info">brixtinlwalker@gmail.com</span>
      <span class="footer-info">CS 260</span>
      <br />
      <a href="https://github.com/BrixtinW/CS_260">GitHub</a>
    </footer>
    <!-- /////////////////////////////////////////////////////////////////////////////// -->

    <script>
    let voteMap = new Map();
    let selected = false;
    var myName = JSON.parse(localStorage.getItem("myName")) || "MY NAME FEATURE NOT WORKING";

    document.addEventListener("DOMContentLoaded", function() {
        var playerNames = JSON.parse(localStorage.getItem("playerNames")) || [];
        var myName = JSON.parse(localStorage.getItem("myName"));
        

        var targetDiv = document.getElementById("carousel");

        playerNames.forEach(function(playerName) {
        var newItem = document.createElement("div");
        newItem.classList.add("item"); 
        newItem.textContent = playerName; 
        newItem.dataset.selected = "false"; 
        voteMap.set(playerName, 0);

        newItem.addEventListener("click", function() {
          newItem.classList.toggle("selected")
            if (newItem.dataset.selected == "false") {
                newItem.dataset.selected = "true";
                selectPlayer(playerName, 1);
            } else {
                newItem.dataset.selected = "false";
                selectPlayer(playerName, -1);
            }
        });

            targetDiv.appendChild(newItem);

        });


        const wordPairs = [
          ["1", "Octopus"],
          ["2", "Octopus"],
          ["3", "Octopus"], 
          ["4", "Octopus"],
          ["5", "Octopus"],
          ["6", "Octopus"],
          ["7", "Octopus"],
          ["8", "Octopus"],
          ["9", "Octopus"],
          ["10", "Octopus"],
          ["11", "Octopus"],
          ["12", "Octopus"],
          ["13", "Octopus"],
          ["14", "Octopus"],
          ["15", "Octopus"],
          ["16", "Octopus"],
          ["17!!", "Octopus"],]

        const randomNum = Math.floor(Math.random() * wordPairs.length); 
        const secretWord = wordPairs[randomNum][0];


        var secretWordDisplay= document.getElementById("secretWordDisplay");
        secretWordDisplay.textContent = secretWord;

    });

    

    // window.addEventListener("beforeunload", function(event) {
    //     localStorage.clear();
    // });


    function selectPlayer(playerName, increment) {
    voteMap.set(playerName, (voteMap.get(playerName)) + increment);
    console.log(playerName, "has", voteMap.get(playerName), "votes!");
    console.log(voteMap);
}

  function readTheVotes(){
    event.preventDefault();

    let highestVote = 0;
    let highestPlayer = null;
    let tiePlayers = [];

    voteMap.forEach(function(value, key) {
    console.log("Key:", key, "Value:", value);
    if (value > highestVote){
      highestVote = value;
      highestPlayer = key;
      tiePlayers = [];
    } else if (value == highestVote){
      tiePlayers.push(key);
    }
});
      if (tiePlayers.length == 0){
        console.log( `${highestPlayer} voted out!`);
            // Retrieve player names from local storage
      var playerNames = JSON.parse(localStorage.getItem("playerNames")) || [];

      // Find the index of the name you want to delete
      var indexToDelete = playerNames.indexOf(highestPlayer);

      // Check if the name exists in the array
      if (indexToDelete !== -1) {
          // Remove the name from the array
          playerNames.splice(indexToDelete, 1);

          // Update local storage with the modified array
          localStorage.setItem("playerNames", JSON.stringify(playerNames));


          if (highestPlayer == myName) {
            alert("you were voted out!")
            localStorage.clear();
          }


          // Reload the page
          location.reload();
      } else {
          // Name not found in the array
          console.error("Name not found in local storage");
      }

    } else {
      // console.log( `tie between ${highestPlayer} and ${tiePlayers}`)
      alert(`tie between ${highestPlayer} and ${tiePlayers}`)
    }
    console.log(voteMap)












  }


  </script>
  </body>
</html>